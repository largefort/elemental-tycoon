<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elemental Tycoon</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="disable.css">
</head>
<body>
    <div id="game">
        <h1>Elemental Tycoon</h1>

        <!-- Total Money and EPS Section -->
        <div id="stats">
            <div id="money-container">
                <h3>Total Money: $<span id="money">0</span></h3>
                <h3>Prestige Currency: <span id="essence">0</span> Essence</h3>
                <h3>Prestige Multiplier: x<span id="prestige-multiplier">1</span></h3>
            </div>
            <div id="eps-container">
                <h4>Elements per Second (EPS)</h4>
                <div id="eps">
                    <p>Fire: <span id="fire-eps">0</span> EPS</p>
                    <p>Water: <span id="water-eps">0</span> EPS</p>
                    <p>Earth: <span id="earth-eps">0</span> EPS</p>
                    <p>Air: <span id="air-eps">0</span> EPS</p>
                    <p>Light: <span id="light-eps">0</span> EPS</p>
                    <p>Dark: <span id="dark-eps">0</span> EPS</p>
                    <p>Void: <span id="void-eps">0</span> EPS</p>
                </div>
            </div>
        </div>

        <!-- Element Resource Sections -->
        <div id="resources">
            <!-- Existing Elements -->
            <div class="resource" id="fire-resource">
                <h2>Fire: <span id="fire">0</span></h2>
                <div class="resource-buttons">
                    <button onclick="gather('fire')">Gather Fire</button>
                    <button onclick="buyAutomation('fire')">Automate Fire ($50)</button>
                </div>
                <div class="progress" id="fire-progress">
                    <div class="progress-bar"></div>
                    <span>0%</span>
                </div>
            </div>
            <div class="resource" id="water-resource">
                <h2>Water: <span id="water">0</span></h2>
                <div class="resource-buttons">
                    <button onclick="gather('water')">Gather Water</button>
                    <button onclick="buyAutomation('water')">Automate Water ($50)</button>
                </div>
                <div class="progress" id="water-progress">
                    <div class="progress-bar"></div>
                    <span>0%</span>
                </div>
            </div>
            <div class="resource" id="earth-resource">
                <h2>Earth: <span id="earth">0</span></h2>
                <div class="resource-buttons">
                    <button onclick="gather('earth')">Gather Earth</button>
                    <button onclick="buyAutomation('earth')">Automate Earth ($50)</button>
                </div>
                <div class="progress" id="earth-progress">
                    <div class="progress-bar"></div>
                    <span>0%</span>
                </div>
            </div>
            <div class="resource" id="air-resource">
                <h2>Air: <span id="air">0</span></h2>
                <div class="resource-buttons">
                    <button onclick="gather('air')">Gather Air</button>
                    <button onclick="buyAutomation('air')">Automate Air ($50)</button>
                </div>
                <div class="progress" id="air-progress">
                    <div class="progress-bar"></div>
                    <span>0%</span>
                </div>
            </div>
            
            <!-- New Elements -->
            <div class="resource" id="light-resource">
                <h2>Light: <span id="light">0</span></h2>
                <div class="resource-buttons">
                    <button onclick="gather('light')">Gather Light</button>
                    <button onclick="buyAutomation('light')">Automate Light ($50)</button>
                </div>
                <div class="progress" id="light-progress">
                    <div class="progress-bar"></div>
                    <span>0%</span>
                </div>
            </div>
            <div class="resource" id="dark-resource">
                <h2>Dark: <span id="dark">0</span></h2>
                <div class="resource-buttons">
                    <button onclick="gather('dark')">Gather Dark</button>
                    <button onclick="buyAutomation('dark')">Automate Dark ($50)</button>
                </div>
                <div class="progress" id="dark-progress">
                    <div class="progress-bar"></div>
                    <span>0%</span>
                </div>
            </div>
            <div class="resource" id="void-resource">
                <h2>Void: <span id="void">0</span></h2>
                <div class="resource-buttons">
                    <button onclick="gather('void')">Gather Void</button>
                    <button onclick="buyAutomation('void')">Automate Void ($50)</button>
                </div>
                <div class="progress" id="void-progress">
                    <div class="progress-bar"></div>
                    <span>0%</span>
                </div>
            </div>
        </div>
        
        <!-- Marketing Strategies Section -->
        <h2>Marketing Strategies</h2>
        <div id="marketing">
            <button onclick="buyMarketing('fire')">Promote Fire ($10)</button>
            <button onclick="buyMarketing('water')">Promote Water ($10)</button>
            <button onclick="buyMarketing('earth')">Promote Earth ($10)</button>
            <button onclick="buyMarketing('air')">Promote Air ($10)</button>
            <!-- Marketing for New Elements -->
            <button onclick="buyMarketing('light')">Promote Light ($10)</button>
            <button onclick="buyMarketing('dark')">Promote Dark ($10)</button>
            <button onclick="buyMarketing('void')">Promote Void ($10)</button>
        </div>

        <!-- Prestige System Section -->
        <h2>Prestige System</h2>
        <div id="prestige">
            <button onclick="prestige()">Prestige (Requires $100,000)</button>
            <p>Prestige Multiplier: x<span id="prestige-multiplier">1</span></p>
        </div>

        <!-- Prestige Upgrades Section -->
        <h2>Prestige Upgrades</h2>
        <div id="prestige-upgrades">
            <p>Use Essence to buy upgrades that enhance your gameplay:</p>
            <div id="upgrade-list">
                <!-- Dynamically generated upgrades will appear here -->
            </div>
        </div>

        <!-- Random Upgrade Generator -->
        <h2>Random Upgrade Generator</h2>
        <div id="random-upgrade">
            <p>Every 30 minutes, a new upgrade will be available:</p>
            <div id="random-upgrade-display">
                <!-- Random upgrade will appear here -->
            </div>
        </div>

        <!-- Version Switching Section -->
        <h2>Version Switching</h2>
        <div id="version-switching">
            <button onclick="switchVersion('live')">Switch to Live Version</button>
            <button onclick="switchVersion('alpha')">Switch to Alpha Version</button>
            <button onclick="switchVersion('beta')">Switch to Beta Version</button>
        </div>

        <!-- Delete Progress Button -->
        <div id="reset">
            <button onclick="deleteProgress()">Delete Progress</button>
        </div>
    </div>

    <script>
const resources = {
    fire: 0,
    water: 0,
    earth: 0,
    air: 0,
    light: 0,
    dark: 0,
    void: 0
};

const marketing = {
    fire: 0,
    water: 0,
    earth: 0,
    air: 0,
    light: 0,
    dark: 0,
    void: 0
};

const automation = {
    fire: false,
    water: false,
    earth: false,
    air: false,
    light: false,
    dark: false,
    void: false
};

const eps = {
    fire: 0,
    water: 0,
    earth: 0,
    air: 0,
    light: 0,
    dark: 0,
    void: 0
};

let money = 0;
let essence = 0; // Prestige currency
let prestigeMultiplier = 1.00; // Multiplier from prestige upgrades
let permanentMultiplierBonus = 1.00; // Permanent multiplier bonus gained from each prestige
let upgrades = []; // List of upgrades

const prefixes = [
    '', 'K', 'M', 'B', 'T', 'Qa', 'Qi', 'Sx', 'Sp', 'Oc', 'No', 'Dc', 'Ud', 'Dd', 'Td', 'Qad', 'Qid', 'Sxd', 'Spd', 'Ocd', 'Nod', 
    'Vg', 'Uvg', 'Dvg', 'Tvg', 'Qavg', 'Qivg', 'Sxvg', 'Spvg', 'Ocvg', 'Novg', 'Tr', 'Utr', 'Dtr', 'Ttr', 'Qatr', 'Qitr', 'Sxtr', 
    'Sptr', 'Octr', 'Notr', 'Qt', 'Uqt', 'Dqt', 'Tqt', 'Qaqt', 'Qiqt', 'Sxqt', 'Spqt', 'Ocqt', 'Noqt', 'Qn', 'Uqn', 'Dqn', 'Tqn', 
    'Qaqn', 'Qiqn', 'Sxqn', 'Spqn', 'Ocqn', 'Noqn', 'Se', 'Use', 'Dse', 'Tse', 'Qase', 'Qise', 'Sxse', 'Spse', 'Ocse', 'Nose', 
    'St', 'Ust', 'Dst', 'Tst', 'Qast', 'Qist', 'Sxst', 'Spst', 'Ocst', 'Nost', 'Og', 'Uog', 'Dog', 'Tog', 'Qaog', 'Qiog', 'Sxog', 
    'Spog', 'Ocog', 'Noog', 'Ng', 'Ung', 'Dng', 'Tng', 'Qang', 'Qing', 'Sxng', 'Spng', 'Ocng', 'Nonng', 'Ce', 'Uce', 'Dce', 'Tce', 
    'Qace', 'Qice', 'Sxce', 'Spce', 'Occe', 'Noce', 'Dce', 'Udce', 'Ddce', 'Tdce', 'Qadce', 'Qidce', 'Sxdce', 'Spdce', 'Ocdce', 'Nodce'
];

const upgradeNames = [
    'Blazing Fury', 'Ocean’s Whisper', 'Earthen Might', 'Aerial Grace', 'Radiant Surge', 'Shadow Veil', 'Void’s Embrace',
    'Inferno Blast', 'Tidal Wave', 'Quake Strike', 'Zephyr Speed', 'Solar Flare', 'Dark Pulse', 'Abyssal Echo',
    'Phoenix Ascend', 'Tempest Roar', 'Stone Guardian', 'Wind Dancer', 'Light Bringer', 'Night Stalker', 'Cosmic Reaver'
];

let fps = 60; // Default FPS value
let lastFrameTime = 0;
let gameLoop; // Variable to hold the game loop interval

function setFPS(newFPS) {
    fps = newFPS;
    clearInterval(gameLoop); // Clear the existing loop
    startGameLoop(); // Start a new loop with the updated FPS
}

function startGameLoop() {
    gameLoop = setInterval(() => {
        const now = performance.now();
        const delta = now - lastFrameTime;
        if (delta > 1000 / fps) {
            updateDisplay(); // Update game display
            lastFrameTime = now - (delta % (1000 / fps));
        }
    }, 1000 / fps);
}

function formatNumber(number) {
    if (number < 1000) return number.toFixed(2).replace(/\.00$/, '');
    let tier = Math.floor(Math.log10(number) / 3);
    let suffix = prefixes[tier] || `e${tier * 3}`;
    let scale = Math.pow(10, tier * 3);
    let scaled = number / scale;
    return scaled.toFixed(2) + suffix;
}

function loadGame() {
    const savedData = JSON.parse(localStorage.getItem('elementalTycoon'));
    if (savedData) {
        Object.assign(resources, savedData.resources);
        Object.assign(marketing, savedData.marketing);
        Object.assign(automation, savedData.automation);
        Object.assign(eps, savedData.eps);
        money = savedData.money;
        essence = savedData.essence;
        prestigeMultiplier = savedData.prestigeMultiplier || 1.00;
        permanentMultiplierBonus = savedData.permanentMultiplierBonus || 1.00;
        upgrades = savedData.upgrades || [];
        updateDisplay();
        displayUpgrades();
        startAutomation();
    }
}

function saveGame() {
    localStorage.setItem('elementalTycoon', JSON.stringify({
        resources,
        marketing,
        automation,
        eps,
        money,
        essence,
        prestigeMultiplier,
        permanentMultiplierBonus,
        upgrades
    }));
}

function deleteProgress() {
    if (confirm("Are you sure you want to delete your progress? This action cannot be undone.")) {
        localStorage.removeItem('elementalTycoon');
        resetGame(true);
        updateDisplay();
        alert("Progress deleted! The game has been reset.");
    }
}

function resetGame(includeEssence = false) {
    for (let element in resources) {
        resources[element] = 0;
        marketing[element] = 0;
        automation[element] = false;
        eps[element] = 0;
    }
    money = 0;
    prestigeMultiplier = permanentMultiplierBonus; // Reset to permanent bonus multiplier

    // Clear upgrades array to delete prestige-generated upgrades
    upgrades = [];

    if (includeEssence) {
        essence = 0;
    }
    
    updateDisplay();
    displayUpgrades(); // Make sure to update the display to reflect the cleared upgrades
}

function updateDisplay() {
    for (let element in resources) {
        const currentResourceText = document.getElementById(element).textContent;
        const formattedResource = formatNumber(resources[element]);
        if (currentResourceText !== formattedResource) {
            document.getElementById(element).textContent = formattedResource;
        }

        const currentEpsText = document.getElementById(`${element}-eps`).textContent;
        const formattedEps = formatNumber(eps[element] * prestigeMultiplier);
        if (currentEpsText !== formattedEps) {
            document.getElementById(`${element}-eps`).textContent = formattedEps;
        }

        updateProgressBar(element);
    }

    const formattedMoney = formatNumber(money);
    if (document.getElementById('money').textContent !== formattedMoney) {
        document.getElementById('money').textContent = formattedMoney;
    }

    const formattedEssence = formatNumber(essence);
    if (document.getElementById('essence').textContent !== formattedEssence) {
        document.getElementById('essence').textContent = formattedEssence;
    }

    const formattedPrestigeMultiplier = prestigeMultiplier.toFixed(2);
    if (document.getElementById('prestige-multiplier').textContent !== formattedPrestigeMultiplier) {
        document.getElementById('prestige-multiplier').textContent = formattedPrestigeMultiplier;
    }
}

function recalculateEPS(element) {
    if (automation[element]) {
        eps[element] = (1 + marketing[element]) * prestigeMultiplier;
    } else {
        eps[element] = 0;
    }
    updateDisplay();
}

function gather(element) {
    resources[element]++;
    money += (1 + marketing[element]) * prestigeMultiplier;
    updateDisplay();
}

function updateProgressBar(element) {
    const progressBar = document.querySelector(`#${element}-progress .progress-bar`);
    const progressText = document.querySelector(`#${element}-progress span`);
    if (progressBar && progressText) {
        const progress = ((resources[element] % 100)).toFixed(2);
        progressBar.style.width = `${progress}%`;
        progressText.textContent = `${progress}%`;
    }
}

function buyMarketing(element) {
    if (money >= 10) {
        money -= 10;
        marketing[element]++;
        recalculateEPS(element);
        updateDisplay();
    } else {
        alert("Not enough money!");
    }
}

function buyAutomation(element) {
    if (money >= 50 && !automation[element]) {
        money -= 50;
        automation[element] = true;
        recalculateEPS(element);
        updateDisplay();
        startAutomationForElement(element);
    } else if (automation[element]) {
        alert(`${element.charAt(0).toUpperCase() + element.slice(1)} is already automated!`);
    } else {
        alert("Not enough money!");
    }
}

function startAutomationForElement(element) {
    if (automation[element]) {
        setInterval(() => {
            resources[element] += eps[element];
            money += eps[element] * (1 + marketing[element]);
            updateDisplay();
        }, 1000);
    }
}

function startAutomation() {
    for (let element in automation) {
        if (automation[element]) {
            startAutomationForElement(element);
        }
    }
}

function prestige() {
    if (money >= 100000) {
        const earnedEssence = Math.floor(money / 100000);
        essence += earnedEssence;

        // Calculate the previous multiplier for comparison
        const previousMultiplier = permanentMultiplierBonus;

        // Increase the permanent multiplier bonus with each prestige
        permanentMultiplierBonus *= 1.10; // For example, each prestige increases it by 10%

        // Calculate the increase in multiplier
        const multiplierIncrease = (permanentMultiplierBonus - previousMultiplier).toFixed(2);

        alert(`Prestiged! You earned ${formatNumber(earnedEssence)} Essence. Your permanent multiplier has increased by x${multiplierIncrease}!`);

        resetGame();
        generateRandomUpgrade();
        updateDisplay();
    } else {
        alert("You need $100,000 to prestige!");
    }
}

function getRandomUpgradeName() {
    return upgradeNames[Math.floor(Math.random() * upgradeNames.length)];
}

function generateRandomUpgrade() {
    let upgrade = {
        name: getRandomUpgradeName(),
        cost: 10 + upgrades.length * 5,
        effect: parseFloat((Math.random() * 2 + 0.1).toFixed(2)),
        purchased: false
    };

    upgrades.push(upgrade);
    displayUpgrades();
    setTimeout(generateRandomUpgrade, 30 * 60 * 1000);
}

function displayUpgrades() {
    let upgradeList = document.getElementById('upgrade-list');
    upgradeList.innerHTML = '';

    upgrades.forEach((upgrade, index) => {
        let upgradeDiv = document.createElement('div');
        upgradeDiv.innerHTML = `${upgrade.name} - Cost: ${formatNumber(upgrade.cost)} Essence - Effect: x${upgrade.effect.toFixed(2)} 
                                <button onclick="buyUpgrade(${index})">Buy</button>`;
        upgradeList.appendChild(upgradeDiv);
    });
}

function buyUpgrade(index) {
    if (essence >= upgrades[index].cost && !upgrades[index].purchased) {
        essence -= upgrades[index].cost;
        upgrades[index].purchased = true;
        prestigeMultiplier = (prestigeMultiplier * upgrades[index].effect).toFixed(2);
        prestigeMultiplier = parseFloat(prestigeMultiplier);
        document.getElementById('essence').textContent = formatNumber(essence);
        document.getElementById('prestige-multiplier').textContent = prestigeMultiplier.toFixed(2);
        displayUpgrades();
        alert('Upgrade purchased!');
    } else {
        alert('Not enough Essence or already purchased!');
    }
}

function switchVersion(version) {
    switch (version) {
        case 'live':
            window.location.href = 'index_live.html';
            break;
        case 'alpha':
            window.location.href = 'index_alpha.html';
            break;
        case 'beta':
            window.location.href = 'index_beta.html';
            break;
        default:
            alert('Version not recognized.');
    }
}

setInterval(saveGame, 10000); // Save game every 10 seconds

window.onload = () => {
    loadGame();
    generateRandomUpgrade();
    startGameLoop(); // Start the optimized game loop
};
    </script>
</body>
</html>
